<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Arch Linux - Lenovo ThinkPad T14 Gen 4 (Intel) | Wilderness Downtown</title>
<link rel=canonical href=https://julianyap.com/pages/2024-10-31-1730430246/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://julianyap.com/pages/2024-10-31-1730430246/"><meta property="og:site_name" content="Wilderness Downtown"><meta property="og:title" content="Arch Linux - Lenovo ThinkPad T14 Gen 4 (Intel)"><meta property="og:description" content="Introduction I have installed Arch Linux on a Lenovo ThinkPad T14 Gen 4 (Intel) “work” machine. This page outlines some setup items and other issues.
Background I wanted to get a better laptop for Linux after using it on a poorly supported Surface Book 3, which was a former work laptop that I obtained for free.
The Lenovo ThinkPad T14 Gen 4 (Intel) didn’t have a dedicated Arch Linux page when I bought it (I have since created one), but it does have Ubuntu certification, and other online reports gave me confidence that there wouldn’t be any issues."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="pages"><meta property="article:published_time" content="2024-10-31T20:04:06-07:00"><meta property="article:modified_time" content="2024-10-31T20:04:06-07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Arch Linux - Lenovo ThinkPad T14 Gen 4 (Intel)"><meta name=twitter:description content="Introduction I have installed Arch Linux on a Lenovo ThinkPad T14 Gen 4 (Intel) “work” machine. This page outlines some setup items and other issues.
Background I wanted to get a better laptop for Linux after using it on a poorly supported Surface Book 3, which was a former work laptop that I obtained for free.
The Lenovo ThinkPad T14 Gen 4 (Intel) didn’t have a dedicated Arch Linux page when I bought it (I have since created one), but it does have Ubuntu certification, and other online reports gave me confidence that there wouldn’t be any issues."><link rel=stylesheet href=https://julianyap.com/css/styles.3293cde0ba45207bc30ea388dcd0b13853ce2a765f7062b3b64049d144d97ff3ebebfe523de731ae740d355ea236be1fb55794d29a7f84012e98e293c9da881c.css integrity="sha512-MpPN4LpFIHvDDqOI3NCxOFPOKnZfcGKztkBJ0UTZf/Pr6/5SPecxrnQNNV6iNr4ftVeU0pp/hAEumOKTydqIHA=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://julianyap.com/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://julianyap.com/><div id=logo><svg viewBox="0 0 512 512"><path d="M284.3 11.7c-15.6-15.6-40.9-15.6-56.6.0l-216 216c-15.6 15.6-15.6 40.9.0 56.6l216 216c15.6 15.6 40.9 15.6 56.6.0l216-216c15.6-15.6 15.6-40.9.0-56.6l-216-216z" fill="#980004"/></svg></div><div id=title><h1>Wilderness Downtown</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/pages>Pages</a></li><li><a href=/snippets>Snippets</a></li><li><a href=/about>About</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class=content itemprop=articleBody><h2 id=introduction>Introduction</h2><p>I have installed Arch Linux on a Lenovo ThinkPad T14 Gen 4 (Intel) &ldquo;work&rdquo; machine. This page outlines some setup items and other issues.</p><h2 id=background>Background</h2><p>I wanted to get a better laptop for Linux after using it on a poorly supported <a href=./2024-04-04-1712257725.md>Surface Book 3</a>, which was a former work laptop that I obtained for free.</p><p>The Lenovo ThinkPad T14 Gen 4 (Intel) didn&rsquo;t have a dedicated Arch Linux page when I bought it (I have since <a href=https://wiki.archlinux.org/title/Lenovo_ThinkPad_T14/T14s_(Intel)_Gen_4>created one</a>), but it does have <a href=https://ubuntu.com/certified/202303-31392>Ubuntu certification</a>, and other online reports gave me confidence that there wouldn&rsquo;t be any issues.</p><p>This model of laptop was released in May 2023, with the latest release being the Gen 5. A slightly older generation laptop generally means better compatibility with the latest kernels.</p><p>This model has soldered RAM, so I made sure to buy it with 32 GB of RAM, which I anticipate will be sufficient for the near future. There aren&rsquo;t many upgrade/repair options other than changing out the SSD and battery, which was fine for my needs.</p><p>In terms of price, I was looking for a cheaper refurbished or open box machine and didn&rsquo;t want to spend over $1000.</p><p>Other models I considered:</p><ul><li><p>Framework 13</p><ul><li>The amount of hardware configuration options seemed overkill for my needs</li><li>Difficult to find refurbished</li><li>Not as established a supplier compared to Lenovo</li></ul></li><li><p>Lenovo ThinkPad X1 Carbon Gen 11 (December 2022)</p><ul><li>More expensive due to focus on lightness</li><li>No replaceable RAM or batteries</li><li>The lack of a replaceable battery was a dealbreaker</li></ul></li><li><p>Lenovo ThinkPad T14S Gen 4 (May 2023)</p><ul><li>Would have been my preferred model as it&rsquo;s slightly lighter than the T14</li><li>Doesn&rsquo;t have an ethernet port (which I don&rsquo;t require)</li><li>Less popular than the T14, so couldn&rsquo;t find any with 32 GB of RAM</li></ul></li><li><p>Lenovo ThinkPad T14 Gen 5 (May 2024)</p><ul><li>Strongly considered this option</li><li>RAM is replaceable with two DDR5 SO-DIMMs</li><li>Uses a more repair-friendly design</li><li>Being the latest generation, cheaper models hadn&rsquo;t yet hit the market</li><li>According to <a href="https://www.youtube.com/watch?v=MEHBvHuBTSM&amp;t=746s">a review</a>, the soldered RAM of the Gen 4 might actually improve battery life</li></ul></li></ul><h2 id=installation>Installation</h2><p>Installation is pretty straightforward.</p><h3 id=set-the-console-font>Set the console font</h3><p>I haven&rsquo;t set this before but it seems handy since the default font is very small on modern displays.</p><pre tabindex=0><code>setfont sun12x22
</code></pre><p>Make this persistent:</p><pre tabindex=0><code>$ cat /etc/vconsole.conf 
FONT=sun12x22
</code></pre><h3 id=partition-layout>Partition layout</h3><p>I delete the Windows partition and set the Swap partition the same size as the RAM to enable <a href=#hibernate>Hibernation</a>.</p><pre tabindex=0><code>Device            Start        End   Sectors   Size Type
/dev/nvme0n1p1     2048    2099199   2097152     1G EFI System
/dev/nvme0n1p2  2099200   71305215  69206016    33G Linux swap
/dev/nvme0n1p3 71305216 1000214527 928909312 442.9G Linux root (x86-64)
</code></pre><h3 id=boot-loader>Boot loader</h3><p>Previously I&rsquo;ve only ever used Grub so I went with rEFInd which is more graphical and modern.</p><pre tabindex=0><code>pacman -S refind
</code></pre><p>Install</p><pre tabindex=0><code>refind-install
</code></pre><p>This doesn&rsquo;t give you a working configuration so you need to modify the config file with the correct boot parameters.</p><pre tabindex=0><code>$ cat /boot/refind_linux.conf 
&#34;Boot with standard options&#34;  &#34;rw root=/dev/nvme0n1p3 resume=/dev/nvme0n1p2&#34;
&#34;Boot to single-user mode&#34;    &#34;rw root=/dev/nvme0n1p3 single&#34;
&#34;Boot with minimal options&#34;   &#34;ro root=/dev/nvme0n1p3&#34;
</code></pre><h2 id=post-installation>Post-Installation</h2><h3 id=network>Network</h3><pre tabindex=0><code>pacman -S networkmanager
</code></pre><p>Enable</p><pre tabindex=0><code>systemctl enable NetworkManager.service
</code></pre><p>Configure</p><pre tabindex=0><code>nmtui
</code></pre><h3 id=desktop-environment>Desktop environment</h3><pre tabindex=0><code>pacman -S gnome
</code></pre><h3 id=firmware-updates>Firmware updates</h3><pre tabindex=0><code>pacman -S gnome-firmware
</code></pre><h2 id=post-post-installation>Post Post-installation</h2><p>Stuff I usually do.</p><h3 id=avahi>Avahi</h3><p>Install</p><pre tabindex=0><code>sudo pacman -S avahi nss-mdns
</code></pre><p>Enable and start</p><pre tabindex=0><code>sudo systemctl enable avahi-daemon.service
sudo systemctl start avahi-daemon.service
</code></pre><p>Enable hostname resolution. Modify line in /etc/nsswitch.conf</p><pre tabindex=0><code>hosts: mymachines mdns4_minimal [NOTFOUND=return] resolve [!UNAVAIL=return] files myhostname dns
</code></pre><h3 id=brother-hl-3170cdw-printer>Brother HL-3170CDW printer</h3><p>Install CUPS</p><pre tabindex=0><code>sudo pacman -S cups
systemctl enable cups.service
systemctl restart cups.service
systemctl status cups.service
</code></pre><p>Install driver</p><pre tabindex=0><code>yay -S brother-hl3170cdw
</code></pre><p>Add printer via CUPS Administration http://localhost:631/admin</p><h3 id=hibernate>Hibernate</h3><p>The other steps are to configure the initramfs:</p><ul><li>Add &lsquo;resume&rsquo;</li><li>Regenerate initramfs</li></ul><p>Specify the kernel parameter <code>resume=${swap_device}</code>.</p><p>FROM: <a href=https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate#Hibernation>https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate#Hibernation</a></p><h3 id=jetbrains-mono-apple-and-microsoft-fonts>Jetbrains Mono, Apple and Microsoft fonts</h3><pre tabindex=0><code>sudo pacman -S ttf-jetbrains-mono
yay -S apple-fonts ttf-ms-win11-auto
</code></pre><p>Set the default for Visual Studio Code: <a href=https://stackoverflow.com/questions/59776906/how-do-i-change-vs-code-settings-to-use-jetbrains-mono-font>https://stackoverflow.com/questions/59776906/how-do-i-change-vs-code-settings-to-use-jetbrains-mono-font</a></p><h3 id=ssh-agent>SSH Agent</h3><p>Add this to <code>~/.bashrc</code></p><pre tabindex=0><code># ssh-agent modified from: https://wiki.archlinux.org/title/SSH_keys#ssh-agent
if ! pgrep -u &#34;$USER&#34; ssh-agent &gt; /dev/null; then
    ssh-agent &gt; &#34;$XDG_RUNTIME_DIR/ssh-agent.env&#34;
fi
if [[ ! -f &#34;$SSH_AUTH_SOCK&#34; ]]; then
    source &#34;$XDG_RUNTIME_DIR/ssh-agent.env&#34; &gt;/dev/null
fi
</code></pre><p>Realized that the timeout is set to 1 hour with the &ldquo;-t 1h&rdquo; flag. I removed this since it was annoying.</p><h3 id=yay---aur-helper>Yay - AUR helper</h3><pre tabindex=0><code>sudo pacman -S --needed git base-devel
git clone https://aur.archlinux.org/yay.git
cd yay
# Don&#39;t build debug package. This might break if the PKGBUILD options change
sed -i &#39;s/options=(!lto)/options=(!lto !debug)/&#39; PKGBUILD
makepkg -si
</code></pre><h3 id=other-packages>Other packages</h3><p>Some other packages I install:</p><pre tabindex=0><code>sudo pacman -S bash-completion chromium code git go hugo jq rust sudo vim
</code></pre><pre tabindex=0><code>yay -S freetube
</code></pre><h2 id=laptop-specific>Laptop specific</h2><h3 id=battery-life>Battery life</h3><p>This is generally &ldquo;good&rdquo;. It&rsquo;s not amazing like a MacBook, mostly because it has a much smaller (39300 mWh) battery and is a less optimized Intel processor.</p><h3 id=sound>Sound</h3><p>Install this package to get the sound and microphone to work.</p><pre tabindex=0><code>sudo pacman -S sof-firmware
</code></pre><p>FROM: <a href=https://wiki.archlinux.org/title/Advanced_Linux_Sound_Architecture#ALSA_firmware>https://wiki.archlinux.org/title/Advanced_Linux_Sound_Architecture#ALSA_firmware</a></p><h3 id=suspend-and-hibernation>Suspend and Hibernation</h3><p>This works great out of the box.</p><p>The Lenovo ThinkPad T14 Gen 4 (Intel) only supports &ldquo;modern suspend&rdquo; and this is the direction modern chips are going (eliminating S3 suspend).</p><p>Previously I thought this was an issue since the Surface Book 3 drains battery while on Suspend. This isn&rsquo;t an issue on the ThinkPad and I realize this is because Linux is properly supported.</p></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2024 Julian Yap</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/pages>Pages</a></li><li><a href=/snippets>Snippets</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>